<!doctype html> 
<html lang="en"> 
<head>
    <script>
        // NEW GOOGLE ANALYTICS
    </script>
	<meta charset="UTF-8" />
	<title>Splash</title>
    <script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
    <script type="text/javascript" src="vendor/store.min.js"></script>
    <script type="text/javascript" src="Bullet.js"></script>
    <script type="text/javascript" src="Slime.js"></script>
    <script type="text/javascript" src="HealthBar.js"></script>
    <script type="text/javascript" src="Cheats.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1000, 650, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {

    game.load.image('black', 'assets/black 1000x650.png', 1000, 650);
    game.load.image('sky', 'assets/sky.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('ground2', 'assets/platform6.png');
    game.load.image('shield', 'assets/wilber.png');
    game.load.image('subro', 'assets/hunterhigh.png');
    game.load.image('phaserlogo', 'assets/phaser logo.png', 635, 545);
    game.load.spritesheet('ken', 'assets/ken.png', 64, 64);
    game.load.spritesheet('gavel', 'assets/gavel.png', 32, 32);
    game.load.spritesheet('slime', 'assets/car1 66x24.png', 66, 24);
    game.load.spritesheet('money1', 'assets/money1 30x36.png');
    game.load.spritesheet('money2', 'assets/money2 48x54.png');
    game.load.audio('bgm', 'assets/audio/8 Bit Adventure.mp3');
}

var platforms;
var slimes;
var bullets;
var stars;
var black;

var player;

var healthText;
var healthbar;
var playerHealth = 100;
var invincible = false;

var cursors;
var spaceBar;

var direction = 1;

var bulletXSpeed = 300;

var score = 0;
var scoreText;

var bgm;

var start = true;

function create() {

    //  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);

    

    //  A simple background for our game
    sky = game.add.sprite(0, 0, 'sky');
    sky.scale.setTo(2, 2);

    shield = game.add.sprite(125, 100, 'subro');
    shield.scale.setTo(1, 1);

    //  The platforms group contains the ground and ledges then we enable physics on platforms
    platforms = game.add.group();
    platforms.enableBody = true;

    // Here we create the ground and scale it to fit the width of the game
    var ground = platforms.create(0, game.world.height - 64, 'ground');
    ground.scale.setTo(3, 2);

    //  This stops it from falling away when you jump on it
    ground.body.immovable = true;
    
    // The player and its settings
    player = game.add.sprite(475, game.world.height - 110, 'ken');
    player.scale.setTo(0.75, 0.75);

    black = game.add.sprite(0, 0, 'black');
    black.alpha = 1;

    // game.add.tween(black).to( { alpha: 0 }, 0, Phaser.Easing.Linear.None, true, 0, 0, true);
    
    // splash credits
    text1 = game.add.text(game.world.centerX - 80, 240, 'Created by:', { fontSize: '20px', fill: '#ffffff'});
    text2 = game.add.text(game.world.centerX - 125, 270, 'Jordan Center', { fontSize: '30px', fill: '#ffffff'});
    text3 = game.add.text(game.world.centerX - 45, 310, 'and', { fontSize: '20px', fill: '#ffffff'})
    text4 = game.add.text(game.world.centerX - 125, 340, 'Jacob Bennett', { fontSize: '30px', fill: '#ffffff'});
    
    // text1.anchor.setTo(0.5, 0.5);
    text1.alpha = 0;
    text2.alpha = 0;
    text3.alpha = 0;
    text4.alpha = 0;
    
    game.add.tween(text1).to( { alpha: 1 }, 3000, Phaser.Easing.Linear.None, true, 0, 0, true);
    game.add.tween(text2).to( { alpha: 1 }, 3000, Phaser.Easing.Linear.None, true, 0, 0, true);
    game.add.tween(text3).to( { alpha: 1 }, 3000, Phaser.Easing.Linear.None, true, 0, 0, true);
    game.add.tween(text4).to( { alpha: 1 }, 3000, Phaser.Easing.Linear.None, true, 0, 0, true);
    
    // phaser logo text
    text = game.add.text(485, 75, 'Powered by', { fontSize: '20px', fill: '#ffffff'});

    text.anchor.setTo(0.5, 0.5);
    text.alpha = 0;

    setTimeout(function () {
        game.add.tween(text).to( { alpha: 1 }, 3500, Phaser.Easing.Linear.None, true, 0, 0, true); 
    }, 6000);
    
    phaser = game.add.sprite(game.world.centerX, game.world.centerY, 'phaserlogo');
    phaser.scale.setTo(.80, .80);
    phaser.anchor.setTo(0.5, 0.5);
    phaser.alpha = 0;

    var phasertween = game.add.tween(phaser)
    
    setTimeout(function () {
        phasertween.to( { alpha: 1 }, 3500, Phaser.Easing.Linear.None, true, 0, 0, true);
    }, 6000);
    
    shield = game.add.sprite(game.world.centerX - 10, game.world.centerY - 10, 'shield');
    shield.anchor.setTo(0.5, 0.5);
    shield.alpha = 0;
    
    var shield = game.add.tween(shield)
    
    setTimeout(function () {
        shield.to( { alpha: 1 }, 3500, Phaser.Easing.Linear.None, true, 0, 0, true);
    }, 13000);

    setTimeout(function() {
        game.add.tween(black).to( { alpha: 0 }, 0, Phaser.Easing.Linear.None, true, 0, 0, false);
    }, 21750);

    //  Player physics properties. Give the little guy a slight bounce.
    game.physics.arcade.enable(player);
    player.body.bounce.y = 0.0;
    player.body.gravity.y = 425;
    player.body.collideWorldBounds = true;

    //  Our three animations, walking left ,right and jumping.
    player.animations.add('left', [4, 3, 2, 1], 10, true);
    player.animations.add('right', [7, 8, 9, 10], 10, true);
    player.animations.add('jumpleft', [0], 10, true);
    player.animations.add('jumpright', [11], 10, true);
    player.animations.add('standleft', [5], 10, true);
    player.animations.add('standright', [6], 10, true);

    // makes a stars group and enables physics
    stars = game.add.group();
    stars.enableBody = true;

    // creates the stars and displays them in the game
    // Top row
    // stars.create(250, 131, 'money1');
    // stars.create(475, 114, 'money2');
    // stars.create(715, 131, 'money1');
    // // Middle row
    // stars.create(250, 276, 'money1');
    // stars.create(475, 259, 'money2');
    // stars.create(715, 276, 'money1');
    // // Bottom row
    // stars.create(250, 417, 'money1');
    // stars.create(475, 399, 'money2');
    // stars.create(715, 417, 'money1');

    // the bullet group contains all bullets and enables physics on them.
    bullets = game.add.group();
    bullets.enableBody = true;
    
    // the slime group contains all slimes and enables physics on them. The for loop adds slimes to the game.
    slimes = game.add.group();
    slimes.enableBody = true;

    let slimeLocations = [
        // Top ledge
        // [150, 150],
        // [350, 150],
        // [550, 150],
        
        // // // Second ledge from top
        // [150, 290],
        // [350, 290],
        // [550, 290],
        
        // // // Third ledge from the top
        // [150, 430],
        // [350, 430],
        // [550, 430]
        
    ];

    // a function that gives a random integer
    function getRandomInt(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min)) + min;
    }

    // let offset = 250;
    slimeLocations.forEach(function (location) {
        let rand = getRandomInt(0, 300);
        // setTimeout(() => {
            var slime = new Slime(game, location[0] + rand, location[1]);
            slimes.add(slime);    
        // }, 500 + offset);
        // offset += 500;

    });
    
    // this makes the spacebar the key that shoots bullets
    spaceBar = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    spaceBar.onDown.add(shootBullet, this);
    cursors = game.input.keyboard.createCursorKeys();


    music = game.add.audio('bgm');
    music.play();
    music.volume = 0.5;
}


function update() {
    //  Collide the player and the stars with the platforms
    var hitPlatform = game.physics.arcade.collide(player, platforms);

    var hitSlime = game.physics.arcade.collide(player, slimes);
    
    var killSlime = game.physics.arcade.overlap(bullets, slimes);

    var grabStar = game.physics.arcade.overlap(player, stars, collectStar, null, this);
    

    if (stars.countLiving() == 10){
        store.set('score', score);
        setTimeout(() => game.add.text(400, 75, 'Loading Level 2!', { fontSize: '30px', fill: '#ffd799'}), 1000);
        
        setTimeout(() => {window.location = 'level2.html'}, 3000);
    }

    function collectStar(player, stars) {
        stars.kill();
    }

    // helper
    function playerIsOnGround() {
        return player.body.touching.down && hitPlatform;
    }

    //  Reset the players velocity (movement)
    player.body.velocity.x = 0;

    handlePlayerMovement();

    if (cursors.left.isDown) {

        player.body.velocity.x = -225;
        let animation = playerIsOnGround() ? 'left' : 'jumpleft';
        player.animations.play(animation);

    } else if (cursors.right.isDown) {

        player.body.velocity.x = 225;
        let animation = playerIsOnGround() ? 'right' : 'jumpright';
        player.animations.play(animation);

    } else if (cursors.right.onUp || cursors.left.onUp) {
        //  Stand still
        player.animations.stop();

        if (playerIsOnGround()) {
            let animation = direction == 1 ? 'standright' : 'standleft';
            player.animations.play(animation);
        }
    }
    // Allow the player to jump if they are touching the ground.
    if (cursors.up.isDown && player.body.touching.down && hitPlatform)
    {
        player.frame = 11;
        player.body.velocity.y = -350;
    }
}

</script>

</body>
</html>