<!doctype html> 
<html lang="en"> 
<head>
    <script>
        // NEW GOOGLE ANALYTICS
    </script>
	<meta charset="UTF-8" />
	<title>Splash</title>
    <script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
    <script type="text/javascript" src="vendor/store.min.js"></script>
    <script type="text/javascript" src="Bullet.js"></script>
    <script type="text/javascript" src="Slime.js"></script>
    <script type="text/javascript" src="HealthBar.js"></script>
    <script type="text/javascript" src="Cheats.js"></script>
    <script type="text/javascript" src="Tween.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1000, 650, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {

    game.load.image('black', 'assets/black 1000x650.png', 1000, 650);
    game.load.image('sky', 'assets/sky.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('ground2', 'assets/platform6.png');
    game.load.image('shield', 'assets/wilber.png');
    game.load.image('hunter', 'assets/hunterhigh.png');
    game.load.image('phaserlogo', 'assets/phaser logo.png', 635, 545);
    game.load.spritesheet('ken', 'assets/ken.png', 64, 64);
    game.load.spritesheet('gavel', 'assets/gavel 18x27.png', 18, 27);
    game.load.spritesheet('slime1', 'assets/car1 66x24.png', 66, 24);
    game.load.spritesheet('slime2', 'assets/car2 68x21.png', 68, 21);
    game.load.spritesheet('slime3', 'assets/car3 69x27.png', 69, 27);
    game.load.spritesheet('slime4', 'assets/car4 67x21.png', 67, 21);
    game.load.spritesheet('slime5', 'assets/car5 64x20.png', 64, 20);
    game.load.spritesheet('money1', 'assets/money1 30x36.png');
    game.load.spritesheet('money2', 'assets/money2 48x54.png');
    // game.load.audio('jump', 'assets/audio/Jump_03.ogg');
    // game.load.audio('shoot', 'assets/audio/Shoot_01.ogg');
    // game.load.audio('hitcar', 'assets/audio/Hit_01.ogg');
    // game.load.audio('bgm', 'assets/audio/8 Bit Adventure.mp3');
}

var platforms;
var slimes;
var bullets;
var stars;
var black;

var player;
animationRunning = false;

var pretend = (function() {

    var direction = {
        left: false,
        right: false,
        up: false,
        down: false,
    };

    var move = function(dir, at, duration)
    {
        var that = this;

        setTimeout(function() {that[dir] = true;}, at);
        setTimeout(function() {that[dir] = false;}, at + duration);
    };

    var fire = function(at)
    {
        setTimeout(function() {shootBullet();}, at);
    }

    return {
        move: move,
        fire: fire,
        left: direction.left,
        right: direction.right,
        up: direction.up,
        down: direction.down
    }
})();


var healthText;
var healthbar;
var playerHealth = 100;
var invincible = false;

var cursors;
var spaceBar;

var direction = 1;

var bulletXSpeed = 300;

var score = 0;
var scoreText;

var bgm;

var start = true;

function create() {

    //  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);

    

    //  A simple background for our game
    sky = game.add.sprite(0, 0, 'sky');
    sky.scale.setTo(2, 2);

    hunter = game.add.sprite(125, 100, 'hunter');

    //  The platforms group contains the ground and ledges then we enable physics on platforms
    platforms = game.add.group();
    platforms.enableBody = true;

    // Here we create the ground and scale it to fit the width of the game
    var ground = platforms.create(0, game.world.height - 64, 'ground');
    ground.scale.setTo(3, 2);

    //  This stops it from falling away when you jump on it
    ground.body.immovable = true;
    
    // The player and its settings
    player = game.add.sprite(0, 540, 'ken');
    player.scale.setTo(0.75, 0.75);

    black = game.add.sprite(0, 0, 'black');
    black.alpha = 1;

    skip = game.add.text(850, 600, 'space bar to skip', { fontSize: '15px', fill: '#ffffff'});
    skip.alpha = .2;

    setTimeout(function () {
        game.add.tween(skip).to( { alpha: 0 }, 0, Phaser.Easing.Linear.None, true, 0, 0, false); 
    }, 9000);

    text1 = game.add.text(380, 300, 'Wilber Group', { fontSize: '35px', fill: '#ffffff'});
    text1.alpha = 0

    setTimeout(() => game.add.tween(text1).to({ alpha: 1}, 2000, Phaser.Easing.Linear.None, true, 0, 0, true), 1000);

    text2 = game.add.text(415, 300, 'Presents', { fontSize: '35px', fill: '#ffffff'});
    text2.alpha = 0

    setTimeout(() => game.add.tween(text2).to({ alpha: 1}, 2000, Phaser.Easing.Linear.None, true, 0, 0, true), 6000);

    // KEEP COMMENTED
    // shield = game.add.sprite(game.world.centerX - 10, game.world.centerY - 10, 'shield');
    // shield.anchor.setTo(0.5, 0.5);
    // shield.alpha = 0;
    
    // var shield = game.add.tween(shield)
    
    // setTimeout(function () {
    //     shield.to( { alpha: 1 }, 3250, Phaser.Easing.Linear.None, true, 0, 0, true);
    // }, 11500);

    start = game.add.text(325, 425, 'press the space bar to start', { fontSize: '25px', fill: '#ffffff'});
    start.alpha = 0;

    setTimeout(function() {
        game.add.tween(start).to( { alpha: 1} , 0, Phaser.Easing.Linear.None, true, 0, -1, true);
    }, 10500);

    setTimeout(function() {
        game.add.tween(black).to( { alpha: 0 }, 0, Phaser.Easing.Linear.None, true, 0, 0, false);
    }, 10000);

    //  Player physics properties. Give the little guy a slight bounce.
    game.physics.arcade.enable(player);
    player.body.bounce.y = 0.0;
    player.body.gravity.y = 775;
    player.body.collideWorldBounds = true;

    //  Our three animations, walking left ,right and jumping.
    player.animations.add('left', [4, 3, 2, 1], 10, true);
    player.animations.add('right', [7, 8, 9, 10], 10, true);
    player.animations.add('jumpleft', [0], 10, true);
    player.animations.add('jumpright', [11], 10, true);
    player.animations.add('standleft', [5], 10, true);
    player.animations.add('standright', [6], 10, true);

    // makes a stars group and enables physics
    stars = game.add.group();
    stars.enableBody = true;

    // creates the stars and displays them in the game
    // Top row
    // stars.create(250, 131, 'money1');
    // stars.create(475, 114, 'money2');
    // stars.create(715, 131, 'money1');
    // // Middle row
    // stars.create(250, 276, 'money1');
    // stars.create(475, 259, 'money2');
    // stars.create(715, 276, 'money1');
    // // Bottom row
    // stars.create(250, 417, 'money1');
    // stars.create(475, 399, 'money2');
    // stars.create(715, 417, 'money1');

    // the bullet group contains all bullets and enables physics on them.
    bullets = game.add.group();
    bullets.enableBody = true;
    
    // the slime group contains all slimes and enables physics on them. The for loop adds slimes to the game.
    slimes = game.add.group();
    slimes.enableBody = true;

    let slimeLocations = [
        // Top ledge
        // [0, 540],
        // [350, 150],
        // [550, 150],
        
        // // // Second ledge from top
        // [150, 290],
        // [350, 290],
        // [550, 290],
        
        // // // Third ledge from the top
        // [150, 430],
        // [350, 430],
        // [550, 430]
        
    ];

    slime1 = slimes.create(-100, 574, 'slime1');
    slime1.anchor.setTo(.5, .5);
    slime1.scale.x *= -1;

    // a function that gives a random integer
    // function getRandomInt(min, max) {
    //   min = Math.ceil(min);
    //   max = Math.floor(max);
    //   return Math.floor(Math.random() * (max - min)) + min;
    // }

    // // let offset = 250;
    // slimeLocations.forEach(function (location) {
    //     let rand = getRandomInt(0, 300);
    //     // setTimeout(() => {
            // var slime = new Slime(game, location[0] + rand, location[1]);
            // slimes.add(slime);    
    //     // }, 500 + offset);
    //     // offset += 500;

    // });
    
    function startGame (game) {
        setTimeout(() => {window.location = 'level1.html'}, 500);
    }

    // this makes the spacebar the key that shoots bullets
    spaceBar = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    spaceBar.onDown.add(startGame, this);
    cursors = game.input.keyboard.createCursorKeys();


    // control the movement of the player
    setTimeout(() => {

    pretend.move('right', 0, 2100)
    pretend.move('up', 2100, 500)
    pretend.fire(3000)
    pretend.move('up', 4500, 100000)
    pretend.move('right', 5400, 2250)
    pretend.move('left', 7600, 4300);
    pretend.move('right', 10000, 6500);
    pretend.move('left', 16200, 4250);
    pretend.move('right', 19000, 3575)
    }, 10000);
    
    // music = game.add.audio('bgm');
    // music.play();
    // music.volume = 0.5;

    // jump = game.add.audio('jump');
    // jump.loop = false;
    // jump.volume = 0.5;
    
    // shoot = game.add.audio('shoot');
    // shoot.loop = false;
    // shoot.volume = 0.5;
    
    // hitcar = game.add.audio('hitcar');
    // hitcar.loop = false;
    // hitcar.volume = 0.5;
}


function update() {
    //  Collide the player and the stars with the platforms
    var hitPlatform = game.physics.arcade.collide(player, platforms);

    var hitSlime = game.physics.arcade.collide(player, slimes);
    
    var killSlime = game.physics.arcade.overlap(bullets, slimes);

    var grabStar = game.physics.arcade.overlap(player, stars, collectStar, null, this);
    
    if (stars.countLiving() == 10){
        store.set('score', score);
        setTimeout(() => game.add.text(400, 75, 'Loading Level 2!', { fontSize: '30px', fill: '#ffd799'}), 1000);
        
        setTimeout(() => {window.location = 'level2.html'}, 3000);
    }

    if (killSlime) {
        // hitcar.play();
    }

    function collectStar(player, stars) {
        stars.kill();
    }

    // helper
    function playerIsOnGround() {
        return player.body.touching.down && hitPlatform;
    }

    //  Reset the players velocity (movement)
    player.body.velocity.x = 0;

    handlePlayerMovement();

    if (pretend.left) {
        player.body.velocity.x = -225;
        let animation = playerIsOnGround() ? 'left' : 'jumpleft';
        player.animations.play(animation);

    } else if (pretend.right) {

        player.body.velocity.x = 225;
        let animation = playerIsOnGround() ? 'right' : 'jumpright';
        player.animations.play(animation);

    } else if (! pretend.right || ! pretend.left) {
        //  Stand still
        player.animations.stop();

        if (playerIsOnGround()) {
            let animation = direction == 1 ? 'standright' : 'standleft';
            player.animations.play(animation);
        }
    }

    // Allow the player to jump if they are touching the ground.
    if (pretend.up && player.body.touching.down && hitPlatform)
    {
        // jump.play();
        player.frame = direction == 1 ? 11 : 0;
        player.body.velocity.y = -350;
    }

    function handlePlayerMovement() {
    if (pretend.left) {
        direction = -1;
    }
    else if (pretend.right) {
        direction = 1;
    }
}
    
    // tweenRight1 = game.add.tween(slime1).to({x: 550}, 3000, Phaser.Easing.Linear.None, true);
    // tweenRight.onComplete.addOnce(function() {
    //     game.add.tween(slime1).to({x: 700}, 3000, Phaser.Easing.Linear.None, true);
    // });

    // tweenRight = game.add.tween(slime2).to({x: 550}, 3000, Phaser.Easing.Linear.None, true);

    // tweenRight = game.add.tween(slime3).to({x: 550}, 3000, Phaser.Easing.Linear.None, true);

    // tweenRight = game.add.tween(slime4).to({x: 550}, 3000, Phaser.Easing.Linear.None, true);

    // tweenRight = game.add.tween(slime5).to({x: 550}, 3000, Phaser.Easing.Linear.None, true);

    setTimeout(() => {
        if (animationRunning === false){
            animationRunning = true;
            tweenRight = game.add.tween(slimes).to({x: 1000}, 4300, Phaser.Easing.Linear.None, true);
            // player.scale.setTo(-1, 1);s
            // tweenRight.onComplete.addOnce(function() {
            //     setTimeout(() => game.add.tween(slime1).to({x: 700}, 1000, Phaser.Easing.Linear.None, true), 6500);
            // });
        }

    }, 10000);


}

</script>

</body>
</html>